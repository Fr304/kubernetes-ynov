# kube-prometheus-stack — Helm values template
# Chart    : prometheus-community/kube-prometheus-stack v80.14.3
# Release  : monitoring
# Namespace: monitoring
#
# Ce fichier est un TEMPLATE — utiliser envsubst avant helm install :
#
#   source cluster.env && export MASTER_IP
#   envsubst < kube-prometheus/values.yaml > /tmp/prom-values.yaml
#   helm install monitoring prometheus-community/kube-prometheus-stack \
#     --namespace monitoring --create-namespace \
#     --version 80.14.3 \
#     -f /tmp/prom-values.yaml
#
# Variables requises (définies dans cluster.env) :
#   MASTER_IP  → IP du nœud master (endpoints control-plane)

# -------------------------------------------------------------------
# Prometheus
# -------------------------------------------------------------------
prometheus:
  prometheusSpec:
    retention: 10d
    replicas: 1
    # Sélectionne toutes les PrometheusRules et ServiceMonitors
    ruleSelector: {}
    ruleNamespaceSelector: {}
    serviceMonitorSelector: {}
    serviceMonitorNamespaceSelector: {}
    podMonitorSelector: {}
    podMonitorNamespaceSelector: {}

# -------------------------------------------------------------------
# Alertmanager
# -------------------------------------------------------------------
alertmanager:
  alertmanagerSpec:
    retention: 120h
    replicas: 1

# -------------------------------------------------------------------
# Grafana (géré par la stack — distinct du grafana dans monitoring/)
# -------------------------------------------------------------------
grafana:
  enabled: true
  adminPassword: prom-operator   # À changer en production !
  ingress:
    enabled: false               # Ingress géré séparément (monitoring/grafana-ingress.yaml)

# -------------------------------------------------------------------
# Composants intégrés
# -------------------------------------------------------------------
kubeStateMetrics:
  enabled: true

nodeExporter:
  enabled: true

# Composants control-plane activés après fix des bind-address (voir kubeadm/README.md)
# etcd        : --listen-metrics-urls=http://0.0.0.0:2381
# scheduler   : --bind-address=0.0.0.0
# controller  : --bind-address=0.0.0.0
kubeControllerManager:
  enabled: true
  endpoints:
  - ${MASTER_IP}

kubeScheduler:
  enabled: true
  endpoints:
  - ${MASTER_IP}

kubeEtcd:
  enabled: true
  endpoints:
  - ${MASTER_IP}
  service:
    port: 2381
    targetPort: 2381

# kube-proxy non accessible en bare-metal kubeadm
kubeProxy:
  enabled: false
